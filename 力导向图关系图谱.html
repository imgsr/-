<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Taçš„å…³ç³»å›¾è°±</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style><!-- ç¬¬å››è¡ŒtitleåŒ…è£¹çš„æ˜¯æ ‡é¢˜ï¼Œå¯ä»¥ä»»æ„æ›´æ”¹ -->
body{margin:0;padding:0;background:linear-gradient(135deg,#e0f0ff,#c5e3ff);font-family:"Microsoft YaHei",sans-serif;overflow:hidden;}
.container{position:relative;width:100vw;height:100vh;}
#graph{width:100%;height:100%;}
.header{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.85);border-radius:20px;padding:15px 30px;box-shadow:0 5px 15px rgba(0,0,0,.1);z-index:100;display:flex;align-items:center;justify-content:center;flex-direction:column;max-width:400px;border:2px solid #4a90e2;}
.header-main{display:flex;align-items:center;margin-bottom:8px;}
.user-avatar{width:60px;height:60px;border-radius:50%;margin-right:15px;border:3px solid #ff7979;background:#f0f8ff;display:flex;align-items:center;justify-content:center;color:#ff7979;font-weight:bold;}
.user-info h2{margin:0;color:#333;font-size:20px;font-weight:bold;}
.user-title{color:#ff6b6b;font-size:14px;margin-top:5px;font-weight:bold;}
.clan-info{color:#4a90e2;font-size:14px;margin-top:2px;}
.intimacy-display{background:linear-gradient(to right,#ff9a9e,#fad0c4);border-radius:15px;padding:5px 15px;margin-top:10px;color:white;font-weight:bold;font-size:14px;box-shadow:0 3px 6px rgba(0,0,0,.1);}
.legend{position:absolute;bottom:20px;left:20px;background:rgba(255,255,255,.85);border-radius:15px;padding:15px;box-shadow:0 5px 15px rgba(0,0,0,.1);z-index:100;max-width:250px;}
.legend h3{margin:0 0 10px 0;color:#333;font-size:16px;}
.legend-item{display:flex;align-items:center;margin-bottom:8px;font-size:14px;}
.legend-color{width:20px;height:20px;border-radius:50%;margin-right:10px;border:2px solid white;}
.node{cursor:pointer;filter:drop-shadow(0 3px 5px rgba(0,0,0,.2));}
.tooltip{position:absolute;background:rgba(255,255,255,.95);border-radius:12px;padding:15px;box-shadow:0 8px 20px rgba(0,0,0,.15);max-width:250px;z-index:100;opacity:0;transition:opacity .3s;border:1px solid #ddd;pointer-events:none;}
.tooltip-header{display:flex;align-items:center;margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:10px;}
.tooltip-avatar{width:50px;height:50px;border-radius:50%;margin-right:10px;border:2px solid #4a90e2;}
.tooltip-name{font-weight:bold;font-size:18px;color:#333;}
.tooltip-title{color:#ff7979;font-size:14px;margin-top:3px;}
.tooltip-info{padding-top:8px;color:#666;font-size:14px;line-height:1.5;}
.bg-element{position:absolute;opacity:.08;z-index:1;pointer-events:none;}
.avatar-container{width:100%;height:100%;display:flex;align-items:center;justify-content:center;border-radius:50%;overflow:hidden;background:#f0f8ff;}
.avatar-image{width:100%;height:100%;object-fit:cover;}
</style>
</head>
<body><!-- ä»è¿™é‡Œå¼€å§‹ä½ å°±éœ€è¦å¤§è§„æ¨¡ä¿®æ”¹äº†ï¼Œè¿™é‡Œæ˜¯ç©å®¶ä»¥åŠTaå¥½å‹çš„æ•°æ®ï¼Œç¬¬ä¸€ä½æ˜¯ä¸­å¿ƒç”¨æˆ·(ä¹Ÿå°±æ˜¯æŒ‡å®šçš„ç©å®¶) -->
<div class="container">
  <div id="bg-elements"></div>
  <div class="header">
    <div class="header-main">
      <img class="user-avatar" src="http://å›¾ç‰‡url"><!-- å¡«å…¥ä¸»ç”¨æˆ·çš„å¤´åƒurl -->
      <div class="user-info">
        <h2>ä¸»ç”¨æˆ·</h2><!-- å¡«å…¥ä¸»ç”¨æˆ·çš„æ˜µç§° -->
        <div class="user-title">ç§°å·</div><!-- å¡«å…¥ä¸»ç”¨æˆ·çš„ç§°å· -->
        <div class="clan-info">æˆ˜é˜Ÿçš„åç§°</div><!-- å¡«å…¥ä¸»ç”¨æˆ·çš„æˆ˜é˜Ÿåç§° -->
      </div>
    </div>
    <div class="intimacy-display">äº²å¯†åº¦æ»¡100çš„å¥½å‹æ‰èƒ½å‡ºç°åœ¨å…³ç³»å›¾è°±</div>
  </div>
  <div class="legend">
    <h3>å…³ç³»å›¾ä¾‹</h3>
    <div class="legend-item"><div class="legend-color" style="background:#ff9a9e"></div><span>CP</span></div>
    <div class="legend-item"><div class="legend-color" style="background:#6ecb63"></div><span>å¸ˆçˆ¶</span></div>
    <div class="legend-item"><div class="legend-color" style="background:#4da6ff"></div><span>å¾’å¼Ÿ</span></div>
    <div class="legend-item"><div class="legend-color" style="background:#ffd166"></div><span>æ­æ¡£</span></div>
    <div class="legend-item"><div class="legend-color" style="background:#db4dff"></div><span>é—ºèœœ</span></div>
    <div class="legend-item"><div class="legend-color" style="background:#5e60ce"></div><span>åŸºå‹</span></div>
  </div>
  <svg id="graph"></svg>
  <div class="tooltip"></div>
</div>

<script>
const me={
  id:"center",
  name:"ä¸­å¿ƒèŠ‚ç‚¹çš„ç”¨æˆ·æ˜µç§°",<!-- å¡«å…¥ä¸­å¿ƒèŠ‚ç‚¹çš„ç”¨æˆ·æ˜µç§° -->
  avatar:"https://å›¾ç‰‡url",<!-- å¡«å…¥ä¸­å¿ƒèŠ‚ç‚¹çš„ç”¨æˆ·çš„å¤´åƒurl -->
  level:30,<!-- è¿™é‡Œå¡«å…¥ä¸»ç”¨æˆ·ç­‰çº§ -->
  gender:"(ç”·æˆ–å¥³æˆ–ä¿å¯†)",<!-- è¿™é‡Œå¡«å…¥ä¸»ç”¨æˆ·çš„æ€§åˆ«ï¼Œè¿™é‡Œå¡«æ–‡å­—ï¼Œä¸‹æ–‡å‡ºç°çš„æ€§åˆ«åªèƒ½ç”¨æ•°å­— -->
  title:"ç§°å·",<!-- è¿™é‡Œå¡«å…¥ä¸»ç”¨æˆ·çš„ç§°å· -->
  clan:"æˆ˜é˜Ÿåç§°"<!-- å¡«å…¥ä¸»ç”¨æˆ·çš„æˆ˜é˜Ÿåç§° -->
};
const relMap={
  "0001":{type:"CP",color:"#ff9a9e"},
  "0002":{type:"å¸ˆçˆ¶",color:"#6ecb63"},
  "0003":{type:"å¾’å¼Ÿ",color:"#4da6ff"},
  "0004":{type:"æ­æ¡£",color:"#ffd166"},
  "0005":{type:"é—ºèœœ",color:"#db4dff"},
  "0006":{type:"åŸºå‹",color:"#5e60ce"}
};
const relations={
  "0001":[{id:"f217",nickName:"0001å·CPå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:1,intimacy:217,clan:"æˆ˜é˜Ÿåç§°"}],<!-- genderä¸­æ•°å­—æ˜¯æ€§åˆ«ç”·1,å¥³2,ä¿å¯†0,intimacyæ˜¯äº²å¯†åº¦ï¼Œidæ— ç‰¹æ®Šè¦æ±‚ï¼Œå¯ä»¥æ˜¯fåŠ äº²å¯†åº¦ä¹Ÿå¯ä»¥æ˜¯fåŠ ç©å®¶çŸ­id -->
  "0002":[{id:"f100",nickName:"0002å·å¸ˆå‚…å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:0,intimacy:100,clan:"æˆ˜é˜Ÿåç§°"}],//genderä¸­æ•°å­—æ˜¯æ€§åˆ«ç”·1,å¥³2,ä¿å¯†0,intimacyæ˜¯äº²å¯†åº¦
  "0003":[
    {id:"f892",nickName:"0003å·å¾’å¼Ÿå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å¤´åƒurl",level:30,gender:2,intimacy:100,clan:"æˆ˜é˜Ÿåç§°"},//genderä¸­æ•°å­—æ˜¯æ€§åˆ«ç”·1,å¥³2,ä¿å¯†0,intimacyæ˜¯äº²å¯†åº¦
    {id:"f695",nickName:"0003å·å¾’å¼Ÿå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å¤´åƒurl",level:30,gender:0,intimacy:695,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f125",nickName:"0003å·å¾’å¼Ÿå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:2,intimacy:125,clan:"æˆ˜é˜Ÿåç§°"}
  ],//genderä¸­æ•°å­—æ˜¯æ€§åˆ«ç”·1,å¥³2,ä¿å¯†0,intimacyæ˜¯äº²å¯†åº¦
  "0004":[
    {id:"f234",nickName:"0004å·æ­æ¡£å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:2,intimacy:234,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f278",nickName:"0004å·æ­æ¡£å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:55,gender:2,intimacy:278,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f549",nickName:"0004å·æ­æ¡£å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:1,intimacy:549,clan:"æˆ˜é˜Ÿåç§°"}
  ],
  "0005":[
    {id:"f1403",nickName:"0005å·é—ºèœœå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:2,intimacy:1403,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f1898",nickName:"0005å·é—ºèœœå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:1,intimacy:1898,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f235",nickName:"0005å·é—ºèœœå…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:1,intimacy:235,clan:"æˆ˜é˜Ÿåç§°"}
  ],
  "0006":[
    {id:"f531",nickName:"0006å·åŸºå‹å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:2,intimacy:531,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f168",nickName:"0006å·åŸºå‹å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:1,intimacy:168,clan:"æˆ˜é˜Ÿåç§°"},
    {id:"f326",nickName:"0006å·åŸºå‹å…³ç³»çš„ç”¨æˆ·æ˜µç§°",avatarUrl:"https://å›¾ç‰‡url",level:30,gender:2,intimacy:326,clan:"æˆ˜é˜Ÿåç§°"}
  ]<!-- ä»è¿™é‡Œå¼€å§‹ä½ å°±ä¸ç”¨æ”¹å‚æ•°äº† -->
};

const nodes=[me],links=[];
Object.entries(relations).forEach(([k,arr])=>{
  const {type,color}=relMap[k];
  arr.forEach(f=>{
    const avatarReal=f.avatarUrl && !f.avatarUrl.startsWith("avatar://") && f.avatarUrl!=="" ? f.avatarUrl : `https://ui-avatars.com/api/?name=${encodeURIComponent(f.nickName||"ç©å®¶")}&background=random&size=80`;
    nodes.push({...f,nickName:f.nickName,avatarReal,intimacy:f.intimacy,relationType:type,gender:f.gender===0?"ä¿å¯†":f.gender===1?"ç”·":"å¥³",clan:f.clan||"æ— æˆ˜é˜Ÿ"});
    links.push({source:me.id,target:f.id,relationType:type,color,value:f.intimacy});
  });
});

const bg=d3.select("#bg-elements");
const emojis=["ğŸ”¨","ğŸ¥š","ğŸ®","â­","ğŸ–ï¸"];
for(let i=0;i<25;i++){
  bg.append("div").classed("bg-element",true)
    .style("font-size",`${Math.random()*40+20}px`)
    .style("left",`${Math.random()*100}%`)
    .style("top",`${Math.random()*100}%`)
    .text(emojis[Math.floor(Math.random()*emojis.length)]);
}

const width=window.innerWidth,height=window.innerHeight;
const svg=d3.select("#graph").attr("width",width).attr("height",height);
const container=svg.append("g");

const simulation=d3.forceSimulation(nodes)
  .force("link",d3.forceLink(links).id(d=>d.id).distance(d=>{
    const distMap={CP:100,å¸ˆçˆ¶:180,å¾’å¼Ÿ:220,æ­æ¡£:160,é—ºèœœ:150,åŸºå‹:170};
    return distMap[d.relationType]||180;
  }))
  .force("charge",d3.forceManyBody().strength(-300))
  .force("center",d3.forceCenter(width/2,height/2))
  .force("collision",d3.forceCollide().radius(d=>d.id==="center"?80:50));

const link=container.append("g").selectAll("line")
  .data(links).enter().append("line")
  .attr("stroke",d=>d.color).attr("stroke-width",2)
  .attr("stroke-dasharray","5,2").attr("stroke-opacity",.6);

const linkText=container.append("g").selectAll("text")
  .data(links).enter().append("text")
  .text(d=>d.value).attr("font-size",12).attr("font-weight","bold")
  .attr("fill","#2c3e50").attr("pointer-events","none");

const node=container.append("g").selectAll("g")
  .data(nodes).enter().append("g")
  .attr("class","node")
  .call(d3.drag()
    .on("start",dragstarted)
    .on("drag",dragged)
    .on("end",dragended))
  .on("mouseover",showTooltip)
  .on("mouseout",hideTooltip);

node.append("circle")
  .attr("r",d=>d.id==="center"?40:32)
  .attr("fill","#fff")
  .attr("stroke",d=>d.relationType?relMap[Object.keys(relMap).find(k=>relMap[k].type===d.relationType)].color:"#ff7979")
  .attr("stroke-width",4);

const avatar=node.append("foreignObject")
  .attr("width",d=>d.id==="center"?80:64)
  .attr("height",d=>d.id==="center"?80:64)
  .attr("x",d=>d.id==="center"?-40:-32)
  .attr("y",d=>d.id==="center"?-40:-32);
avatar.append("xhtml:div").attr("class","avatar-container")
  .html(d=>{
    const url=d.avatarReal||d.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(d.nickName||d.name||"ç©å®¶")}&background=random&size=80`;
    return `<img src="${url}" class="avatar-image" onerror="this.src='https://via.placeholder.com/60?text=${(d.nickName||d.name).slice(-2)}'">`;
  });

node.filter(d=>d.id!=="center")
  .append("text").attr("dy",-12).attr("text-anchor","middle")
  .attr("fill",d=>relMap[Object.keys(relMap).find(k=>relMap[k].type===d.relationType)].color)
  .attr("font-weight","bold").text(d=>d.relationType);
node.filter(d=>d.id!=="center")
  .append("text").attr("dy",45).attr("text-anchor","middle")
  .attr("fill","#ff6b6b").attr("font-size",14).attr("font-weight","bold")
  .text(d=>d.intimacy);

function dragstarted(e,d){if(!e.active)simulation.alphaTarget(.3);d.fx=d.x;d.fy=d.y;}
function dragged(e,d){d.fx=e.x;d.fy=e.y;}
function dragended(e,d){if(!e.active)simulation.alphaTarget(0);d.fx=null;d.fy=null;}
simulation.on("tick",()=>{
  link.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y)
      .attr("x2",d=>d.target.x).attr("y2",d=>d.target.y);
  linkText.attr("x",d=>(d.source.x+d.target.x)/2).attr("y",d=>(d.source.y+d.target.y)/2+3);
  node.attr("transform",d=>`translate(${d.x},${d.y})`);
});
svg.call(d3.zoom().scaleExtent([.5,3]).on("zoom",e=>container.attr("transform",e.transform)));

function showTooltip(e,d){
  const t=d3.select(".tooltip");
  t.html(`
    <div class="tooltip-header">
      <img src="${d.avatarReal||d.avatar}" class="tooltip-avatar" onerror="this.src='https://via.placeholder.com/50?text=${(d.nickName||d.name).slice(-2)}'"/>
      <div>
        <div class="tooltip-name">${d.nickName||d.name}</div>
        <div class="tooltip-title">${d.title||"æ— ç§°å·"}</div>
      </div>
    </div>
    <div class="tooltip-info">
      <div>å…³ç³»: <b style="color:${relMap[Object.keys(relMap).find(k=>relMap[k].type===d.relationType)].color}">${d.relationType||"è‡ªå·±"}</b></div>
      <div>ç­‰çº§: ${d.level}</div>
      <div>æˆ˜é˜Ÿ: ${d.clan||"æ— æˆ˜é˜Ÿ"}</div>
      <div>äº²å¯†åº¦: <b>${d.intimacy||"æ— "}</b></div>
      <div>æ€§åˆ«: ${d.gender||"ä¿å¯†"}</div>
    </div>
  `).style("left",(e.pageX+15)+"px").style("top",(e.pageY-15)+"px").style("opacity",1);
}
function hideTooltip(){d3.select(".tooltip").style("opacity",0);}
</script>
</body>
</html>
